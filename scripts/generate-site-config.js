/*
  Gera `scripts/site-config.js` a partir do arquivo `.env` na raiz do projeto.
  Uso:
    node scripts/generate-site-config.js

  O script não tem dependências externas e faz parsing simples do arquivo `.env`.
*/

const fs = require("fs");
const path = require("path");

const root = path.resolve(__dirname, "..");
const envPath = path.join(root, ".env");
const outPath = path.join(root, "scripts", "site-config.js");

function parseEnv(content) {
  const res = {};
  content.split(/\r?\n/).forEach((line) => {
    line = line.trim();
    if (!line || line.startsWith("#")) return;
    const eq = line.indexOf("=");
    if (eq === -1) return;
    const key = line.substring(0, eq).trim();
    let val = line.substring(eq + 1).trim();
    // remove surrounding quotes
    if (
      (val.startsWith('"') && val.endsWith('"')) ||
      (val.startsWith("'") && val.endsWith("'"))
    ) {
      val = val.substring(1, val.length - 1);
    }
    res[key] = val;
  });
  return res;
}

if (!fs.existsSync(envPath)) {
  console.error(".env not found at", envPath);
  process.exit(1);
}

const envContent = fs.readFileSync(envPath, "utf8");
const env = parseEnv(envContent);

const SUPABASE_URL = env.SUPABASE_URL || "";
const SUPABASE_ANON_KEY = env.SUPABASE_ANON_KEY || "";

const out = `// Auto-generated by scripts/generate-site-config.js
// NÃO COMITE este arquivo se ele contiver chaves sensíveis
window.SUPABASE_URL = ${JSON.stringify(SUPABASE_URL)};
window.SUPABASE_ANON_KEY = ${JSON.stringify(SUPABASE_ANON_KEY)};
`;

fs.writeFileSync(outPath, out, { encoding: "utf8" });
console.log("Wrote", outPath);
